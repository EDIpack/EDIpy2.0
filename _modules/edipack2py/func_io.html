

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>edipack2py.func_io &mdash; EDIpack2py 5.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=aface3f9" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=ce74c6a2"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EDIpack2py
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pyinstallation.html">EDIpack2py Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pyinstallation.html#anaconda">Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyinstallation.html#install-with-pip">Install with pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pyinstallation.html#install-from-source">Install from source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basicusage.html">Basic usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basicusage.html#module-import">Module import</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basicusage.html#minimal-dmft-loop">Minimal DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../globvars.html">Global variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.beta"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.beta</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Jh"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Jh</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.dmft_error"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.dmft_error</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.ed_total_ud"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.ed_total_ud</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.ed_twin"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.ed_twin</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.eps"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.eps</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Jx"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Jx</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Jp"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Jp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Lmats"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Lmats</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.LOGfile"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.LOGfile</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Lpos"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Lpos</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Lreal"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Lreal</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Ltau"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Ltau</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Nbath"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Nbath</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Nloop"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Nloop</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Norb"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Norb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Nph"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Nph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.nread"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.nread</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Nspin"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Nspin</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Nsuccess"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Nsuccess</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.sb_field"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.sb_field</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Uloc"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Uloc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.Ust"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.Ust</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.wini"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.wini</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.wfin"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.wfin</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.xmin"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.xmin</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.xmax"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.xmax</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../globvars.html#edipack2py.global_env.xmu"><code class="docutils literal notranslate"><span class="pre">edipack2py.global_env.xmu</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html">Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../funcs/0_readinput.html">Input file manipulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/0_readinput.html#edipack2py.global_env.read_input"><code class="docutils literal notranslate"><span class="pre">read_input()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../funcs/1_solver.html">Impurity Problem Initialization, Solution and Finalization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/1_solver.html#edipack2py.global_env.finalize_solver"><code class="docutils literal notranslate"><span class="pre">finalize_solver()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/1_solver.html#edipack2py.global_env.init_solver"><code class="docutils literal notranslate"><span class="pre">init_solver()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/1_solver.html#edipack2py.global_env.set_hloc"><code class="docutils literal notranslate"><span class="pre">set_hloc()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/1_solver.html#edipack2py.global_env.solve"><code class="docutils literal notranslate"><span class="pre">solve()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../funcs/2_bath.html">Bath Manipulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.bath_inspect"><code class="docutils literal notranslate"><span class="pre">bath_inspect()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.break_symmetry_bath"><code class="docutils literal notranslate"><span class="pre">break_symmetry_bath()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.chi2_fitgf"><code class="docutils literal notranslate"><span class="pre">chi2_fitgf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.get_bath_dimension"><code class="docutils literal notranslate"><span class="pre">get_bath_dimension()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.orb_equality_bath"><code class="docutils literal notranslate"><span class="pre">orb_equality_bath()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.orb_symmetrize_bath"><code class="docutils literal notranslate"><span class="pre">orb_symmetrize_bath()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.ph_symmetrize_bath"><code class="docutils literal notranslate"><span class="pre">ph_symmetrize_bath()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.save_array_as_bath"><code class="docutils literal notranslate"><span class="pre">save_array_as_bath()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.set_hgeneral"><code class="docutils literal notranslate"><span class="pre">set_hgeneral()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.set_hreplica"><code class="docutils literal notranslate"><span class="pre">set_hreplica()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/2_bath.html#edipack2py.global_env.spin_symmetrize_bath"><code class="docutils literal notranslate"><span class="pre">spin_symmetrize_bath()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../funcs/3_inputoutput.html">Input / Output Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_dens"><code class="docutils literal notranslate"><span class="pre">get_dens()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_docc"><code class="docutils literal notranslate"><span class="pre">get_docc()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_eimp"><code class="docutils literal notranslate"><span class="pre">get_eimp()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_mag"><code class="docutils literal notranslate"><span class="pre">get_mag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_phi"><code class="docutils literal notranslate"><span class="pre">get_phi()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_gimp"><code class="docutils literal notranslate"><span class="pre">get_gimp()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_sigma"><code class="docutils literal notranslate"><span class="pre">get_sigma()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_g0and"><code class="docutils literal notranslate"><span class="pre">get_g0and()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_delta"><code class="docutils literal notranslate"><span class="pre">get_delta()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_chi"><code class="docutils literal notranslate"><span class="pre">get_chi()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_impurity_rdm"><code class="docutils literal notranslate"><span class="pre">get_impurity_rdm()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../funcs/4_auxiliary.html">Auxiliary procedures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/4_auxiliary.html#edipack2py.global_env.check_convergence"><code class="docutils literal notranslate"><span class="pre">check_convergence()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/4_auxiliary.html#edipack2py.global_env.get_bath_type"><code class="docutils literal notranslate"><span class="pre">get_bath_type()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/4_auxiliary.html#edipack2py.global_env.get_ed_mode"><code class="docutils literal notranslate"><span class="pre">get_ed_mode()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/4_auxiliary.html#edipack2py.global_env.search_variable"><code class="docutils literal notranslate"><span class="pre">search_variable()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../funcs/5_interaction_matrix_parsing.html">Interaction matrix parsing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/5_interaction_matrix_parsing.html#edipack2py.global_env.add_twobody_operator"><code class="docutils literal notranslate"><span class="pre">add_twobody_operator()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../funcs/5_interaction_matrix_parsing.html#edipack2py.global_env.reset_umatrix"><code class="docutils literal notranslate"><span class="pre">reset_umatrix()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TRIQS compatibility layer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../edipack2triqs.html">TRIQS compatibility layer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/edipack/EDIpack2py">EDIpack2py on GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/edipack/EDIpack">EDIpack on GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/SciFortran/SciFortran">SciFortran on GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EDIpack2py</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">edipack2py.func_io</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for edipack2py.func_io</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="c1"># observables</span>


<span class="c1"># density</span>
<div class="viewcode-block" id="get_dens">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_dens">[docs]</a>
<span class="k">def</span> <span class="nf">get_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iorb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This function returns the value of the charge density</span>
<span class="sd">   </span>
<span class="sd">    :type ilat: int</span>
<span class="sd">    :param ilat: if the case of real-space DMFT, if only the Green&#39;s function of \</span>
<span class="sd">    a specific inequivalent site is needed, this can be specified.</span>
<span class="sd">   </span>
<span class="sd">    :type iorb: int</span>
<span class="sd">    :param iorb: the orbital index. If none is provided, the whole density \</span>
<span class="sd">     vector is returned</span>
<span class="sd">   </span>
<span class="sd">    :return: the full charge density tensor has dimensions [ :code:`Nlat` ,Norb]. \</span>
<span class="sd">     Depending on which keyword arguments are (or not) provided, this is sliced \</span>
<span class="sd">     on the corresponding axis.</span>
<span class="sd">    :rtype: float **or** np.array(dtype=float) </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aux_norb</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">ed_get_dens_n1_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_dens_n1</span>
    <span class="n">ed_get_dens_n1_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ed_get_dens_n1_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_dens_n2_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_dens_n2</span>
        <span class="n">ed_get_dens_n2_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
            <span class="n">c_int</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ed_get_dens_n2_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">densvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">aux_norb</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ed_get_dens_n1_wrap</span><span class="p">(</span><span class="n">densvec</span><span class="p">)</span>
        <span class="n">densvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">densvec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat cannot be none for single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">densvec</span><span class="p">[</span><span class="n">iorb</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">densvec</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="n">densvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="n">ed_get_dens_n2_wrap</span><span class="p">(</span><span class="n">densvec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">)</span>
            <span class="n">densvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">densvec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">densvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">iorb</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">densvec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">densvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">densvec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span></div>



<span class="c1"># magnetization</span>
<div class="viewcode-block" id="get_mag">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_mag">[docs]</a>
<span class="k">def</span> <span class="nf">get_mag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icomp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iorb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">       </span>
<span class="sd">       This function returns the value of the magnetization</span>
<span class="sd">      </span>
<span class="sd">       :type icomp: str</span>
<span class="sd">       :param icomp: the component of the magnetization, :code:`&quot;x&quot;`, \</span>
<span class="sd">       :code:`&quot;y&quot;` or :code:`&quot;z&quot;` (default).</span>
<span class="sd">       </span>
<span class="sd">       :type ilat: int</span>
<span class="sd">       :param ilat: if the case of real-space DMFT, if only the Green&#39;s function \</span>
<span class="sd">       of a specific inequivalent site is needed, this can be specified.</span>
<span class="sd">       </span>
<span class="sd">       :type iorb: int</span>
<span class="sd">       :param iorb: the orbital index. If none is provided, the whole density \</span>
<span class="sd">       vector is returned</span>
<span class="sd">       </span>
<span class="sd">       :return: the full magnetization tensor has dimensions [ :code:`Nlat` ,3,Norb]. \</span>
<span class="sd">        Depending on which keyword arguments are (or not) provided, this is \</span>
<span class="sd">        sliced on the corresponding axis.</span>
<span class="sd">       :rtype: float **or** np.array(dtype=float) </span>
<span class="sd">       </span>
<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">icomp</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span> <span class="ow">or</span> <span class="n">icomp</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
        <span class="n">icomp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">icomp</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span> <span class="ow">or</span> <span class="n">icomp</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
        <span class="n">icomp</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">icomp</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span> <span class="ow">or</span> <span class="n">icomp</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
        <span class="n">icomp</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">aux_norb</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">ed_get_mag_n2_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_mag_n2</span>
    <span class="n">ed_get_mag_n2_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ed_get_mag_n2_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_mag_n3_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_mag_n3</span>
        <span class="n">ed_get_mag_n3_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
            <span class="n">c_int</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ed_get_mag_n3_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">magvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ed_get_mag_n2_wrap</span><span class="p">(</span><span class="n">magvec</span><span class="p">)</span>
        <span class="n">magvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">magvec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat cannot be none for single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">magvec</span><span class="p">[</span><span class="n">icomp</span><span class="p">,</span> <span class="n">iorb</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">magvec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">magvec</span><span class="p">[</span><span class="n">icomp</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">magvec</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="n">magvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
            <span class="p">)</span>
            <span class="n">ed_get_mag_n3_wrap</span><span class="p">(</span><span class="n">magvec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">)</span>
            <span class="n">magvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">magvec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">icomp</span><span class="p">,</span> <span class="n">iorb</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">icomp</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:,</span> <span class="n">iorb</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[:,</span> <span class="n">icomp</span><span class="p">,</span> <span class="n">iorb</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[:,</span> <span class="n">icomp</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iorb</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">icomp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">magvec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span></div>



<span class="c1"># double occupation</span>
<div class="viewcode-block" id="get_docc">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_docc">[docs]</a>
<span class="k">def</span> <span class="nf">get_docc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iorb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   This function returns the value of the double occupation</span>
<span class="sd">  </span>
<span class="sd">   :type ilat: int</span>
<span class="sd">   :param ilat: if the case of real-space DMFT, if only the Green&#39;s function of a \</span>
<span class="sd">    specific inequivalent site is needed, this can be specified.</span>
<span class="sd">   </span>
<span class="sd">   :type iorb: int</span>
<span class="sd">   :param iorb: the orbital index. If none is provided, the whole density vector \</span>
<span class="sd">    is returned</span>
<span class="sd">   </span>
<span class="sd">   :return: the full double-occupation tensor has dimensions [ :code:`Nlat` ,Norb]. \</span>
<span class="sd">    Depending on which keyword arguments are (or not) provided, this is sliced \</span>
<span class="sd">    on the corresponding axis.</span>
<span class="sd">   :rtype: float **or** np.array(dtype=float)</span>
<span class="sd">   </span>
<span class="sd">   &quot;&quot;&quot;</span>

    <span class="n">aux_norb</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">ed_get_docc_n1_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_docc_n1</span>
    <span class="n">ed_get_docc_n1_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ed_get_docc_n1_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_docc_n2_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_docc_n2</span>
        <span class="n">ed_get_docc_n2_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
            <span class="n">c_int</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ed_get_docc_n2_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">doccvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">aux_norb</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ed_get_docc_n1_wrap</span><span class="p">(</span><span class="n">doccvec</span><span class="p">)</span>
        <span class="n">doccvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">doccvec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat cannot be none for single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">doccvec</span><span class="p">[</span><span class="n">iorb</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">doccvec</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="n">doccvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="n">ed_get_docc_n2_wrap</span><span class="p">(</span><span class="n">doccvec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">)</span>
            <span class="n">doccvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">doccvec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doccvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">iorb</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doccvec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doccvec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doccvec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span></div>



<span class="c1"># superconductive phi</span>
<div class="viewcode-block" id="get_phi">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_phi">[docs]</a>
<span class="k">def</span> <span class="nf">get_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iorb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">jorb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns the modulus and/or argument of the superconductive order \</span>
<span class="sd">    parameter :math:`\\phi = \\langle c_{\\uparrow} c_{\\downarrow} \\rangle`</span>
<span class="sd">  </span>
<span class="sd">   :type ilat: int</span>
<span class="sd">   :param ilat: if the case of real-space DMFT, if only the Green&#39;s function of a \</span>
<span class="sd">    specific inequivalent site is needed, this can be specified.</span>
<span class="sd">   </span>
<span class="sd">   :type iorb: int</span>
<span class="sd">   :param iorb: the first orbital index</span>
<span class="sd">   </span>
<span class="sd">   :type jorb: int</span>
<span class="sd">   :param jorb: the second orbital index</span>
<span class="sd">   </span>
<span class="sd">   :type component: str</span>
<span class="sd">   :param component: if :code:`mod` returns the modulus of :math:`\\phi`, \</span>
<span class="sd">    if :code:`arg` returns the argument. By default returns both.</span>
<span class="sd">   </span>
<span class="sd">   :return: :math:`|\\phi|`, :math:`\\mathrm{arg}(\\phi)`. \</span>
<span class="sd">    The full tensors have dimensions [ :code:`Nlat`, \</span>
<span class="sd">   :data:`Norb`, :data:`Norb`]. Depending on which keyword arguments are \</span>
<span class="sd">    (or not) provided, this is sliced on the corresponding axis.</span>
<span class="sd">   :rtype: float **or** np.array(dtype=float)</span>
<span class="sd">   </span>
<span class="sd">   &quot;&quot;&quot;</span>

    <span class="n">aux_norb</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">ed_get_phisc_n2_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_phisc_n2</span>
    <span class="n">ed_get_phisc_n2_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">)</span>  <span class="c1"># self</span>
    <span class="p">]</span>
    <span class="n">ed_get_phisc_n2_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_argsc_n2_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_argsc_n2</span>
    <span class="n">ed_get_argsc_n2_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">)</span>  <span class="c1"># self</span>
    <span class="p">]</span>
    <span class="n">ed_get_argsc_n2_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_phisc_n3_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_phisc_n3</span>
        <span class="n">ed_get_phisc_n3_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># Nlat</span>
        <span class="p">]</span>
        <span class="n">ed_get_phisc_n3_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ed_get_argsc_n3_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_argsc_n3</span>
        <span class="n">ed_get_argsc_n3_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">)</span>  <span class="c1"># self</span>
        <span class="p">]</span>
        <span class="n">ed_get_argsc_n3_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">modphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">argphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ed_get_phisc_n2_wrap</span><span class="p">(</span><span class="n">modphivec</span><span class="p">)</span>
        <span class="n">ed_get_argsc_n2_wrap</span><span class="p">(</span><span class="n">argphivec</span><span class="p">)</span>
        <span class="n">modphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">modphivec</span><span class="p">)</span>
        <span class="n">argphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">argphivec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat cannot be none for single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[</span><span class="n">iorb</span><span class="p">,</span> <span class="n">jorb</span><span class="p">]</span>
            <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[</span><span class="n">iorb</span><span class="p">,</span> <span class="n">jorb</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[</span><span class="n">iorb</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[</span><span class="n">iorb</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[:,</span> <span class="n">jorb</span><span class="p">]</span>
            <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[:,</span> <span class="n">jorb</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span>
            <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="n">modphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
            <span class="p">)</span>
            <span class="n">argphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
            <span class="p">)</span>
            <span class="n">ed_get_phisc_n3_wrap</span><span class="p">(</span><span class="n">modphivec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">)</span>
            <span class="n">ed_get_argsc_n3_wrap</span><span class="p">(</span><span class="n">argphivec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">)</span>

            <span class="n">modphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">modphivec</span><span class="p">)</span>
            <span class="n">argphivec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">argphivec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">iorb</span><span class="p">,</span> <span class="n">jorb</span><span class="p">]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">iorb</span><span class="p">,</span> <span class="n">jorb</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">iorb</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">iorb</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">if</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:,</span> <span class="n">jorb</span><span class="p">]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:,</span> <span class="n">jorb</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">,</span> <span class="n">jorb</span><span class="p">]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">,</span> <span class="n">jorb</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[:,</span> <span class="n">iorb</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">if</span> <span class="n">jorb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iorb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">jorb</span><span class="p">]</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">jorb</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">modout</span> <span class="o">=</span> <span class="n">modphivec</span>
                    <span class="n">argout</span> <span class="o">=</span> <span class="n">argphivec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">component</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">modout</span><span class="p">,</span> <span class="n">argout</span>
    <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="s2">&quot;mod&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">modout</span>
    <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="s2">&quot;arg&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">argout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;component can only be None, mod or arg.&quot;</span><span class="p">)</span></div>



<span class="c1"># energy</span>
<div class="viewcode-block" id="get_eimp">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_eimp">[docs]</a>
<span class="k">def</span> <span class="nf">get_eimp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ikind</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function returns the value of the local energy components</span>
<span class="sd">         </span>
<span class="sd">       :type ilat: int</span>
<span class="sd">       :param ilat: if the case of real-space DMFT, if only the Green&#39;s function of \</span>
<span class="sd">       a specific inequivalent site is needed, this can be specified.</span>
<span class="sd">       </span>
<span class="sd">       :type ikind: int</span>
<span class="sd">       :param ikind: index of the component. It is</span>
<span class="sd">        </span>
<span class="sd">        * :code:`1`: ed_Epot: the potential energy from interaction</span>
<span class="sd">        * :code:`2`: ed_Eint: ed-Epot - ed_Ehartree</span>
<span class="sd">        * :code:`3`: ed_Ehartree: Hartree part of interaction energy</span>
<span class="sd">        * :code:`4`: ed_Eknot: on-site part of the kinetic term</span>
<span class="sd">       </span>
<span class="sd">       :return: the full local energy tensor has dimensions [ :code:`Nlat` ,4]. Depending on \</span>
<span class="sd">        which keyword arguments are (or not) provided, this is sliced on the corresponding axis.</span>
<span class="sd">       :rtype: float **or** np.array(dtype=float)    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ed_get_eimp_n1_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_eimp_n1</span>
    <span class="n">ed_get_eimp_n1_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ed_get_eimp_n1_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_eimp_n2_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_eimp_n2</span>
        <span class="n">ed_get_eimp_n2_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
            <span class="n">c_int</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">ed_get_eimp_n2_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">eimp_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">ed_get_eimp_n1_wrap</span><span class="p">(</span><span class="n">eimp_vec</span><span class="p">)</span>
        <span class="n">eimp_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">eimp_vec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat cannot be none for single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ikind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eimp_vec</span><span class="p">[</span><span class="n">ikind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eimp_vec</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="n">eimp_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="n">ed_get_eimp_n2_wrap</span><span class="p">(</span><span class="n">eimp_vec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">)</span>
            <span class="n">eimp_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">eimp_vec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ikind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">eimp_vec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="n">ikind</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ikind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">eimp_vec</span><span class="p">[:,</span> <span class="n">ikind</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ikind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">eimp_vec</span><span class="p">[</span><span class="n">ilat</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">eimp_vec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span></div>



<span class="c1">########################</span>
<span class="c1">#   SIGMA              #</span>
<span class="c1">########################</span>


<span class="c1"># backcompatibility, undocumented</span>
<span class="k">def</span> <span class="nf">build_sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sigma</span><span class="p">(</span><span class="n">zeta</span><span class="o">=</span><span class="n">zeta</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="n">ilat</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="n">ishape</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">typ</span><span class="p">)</span>


<span class="c1"># get Sigma</span>
<div class="viewcode-block" id="get_sigma">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_sigma">[docs]</a>
<span class="k">def</span> <span class="nf">get_sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates the self-energy for a user-chosen set of frequencies \</span>
<span class="sd">    in the complex plane</span>

<span class="sd">    :type ilat: int</span>
<span class="sd">    :param ilat: if the case of real-space DMFT, if only the self-energy of \</span>
<span class="sd">    a specific inequivalent site is needed, this can be specified.</span>
<span class="sd">        </span>
<span class="sd">    :type ishape: int </span>
<span class="sd">    :param ishape: this variable determines the shape of the returned array. \</span>
<span class="sd">     Possible values:</span>
<span class="sd">   </span>
<span class="sd">     * :code:`None`: the same shape as :code:`Hloc` plus one axis for frequency </span>
<span class="sd">     * :code:`3`: in the single-impurity case, it will return an array of the shape \</span>
<span class="sd">       [ :data:`Nspin` :math:`\\cdot`  :data:`Norb` ,  :data:`Nspin` :math:`\\cdot` \</span>
<span class="sd">       :data:`Norb` , :code:`len(zeta)` ]. In the real-space DMFT case, \</span>
<span class="sd">       it will return an array of the shape \</span>
<span class="sd">       [ :code:`Nlat` :math:`\\cdot`  :data:`Nspin` :math:`\\cdot`  :data:`Norb` , \</span>
<span class="sd">       :code:`Nlat` :math:`\\cdot` :data:`Nspin` :math:`\\cdot`  :data:`Norb` , \</span>
<span class="sd">       :code:`len(zeta)` ]. :code:`Nlat` will be determined from the module </span>
<span class="sd">       by assessing the shape of Hloc. If :code:`ilat` is set, ValueError is returned.</span>
<span class="sd">     * :code:`4`: in the real-space DMFT case, it will return an array of the shape \</span>
<span class="sd">       [ :code:`Nlat` ,  :data:`Nspin` :math:`\\cdot`  :data:`Norb` ,  :data:`Nspin` \</span>
<span class="sd">       :math:`\\cdot`  :data:`Norb` , :code:`len(zeta)` `. :code:`Nlat` will \</span>
<span class="sd">       be determined from the module by assessing the shape of Hloc. If :code:`ilat` is \</span>
<span class="sd">       set, the output will have one dimension less.</span>
<span class="sd">     * :code:`5`: in the single-impurity case, it will return an array of the \</span>
<span class="sd">       shape [ :data:`Nspin` ,  :data:`Nspin` ,  :data:`Norb` ,  :data:`Norb` , \</span>
<span class="sd">       :code:`len(zeta)` ].</span>
<span class="sd">     * :code:`6`: in the real-space DMFT case, it will return an array of the \</span>
<span class="sd">       shape [ :code:`Nlat` ,  :data:`Nspin` ,  :data:`Nspin` ,  :data:`Norb` , \</span>
<span class="sd">       :data:`Norb` , :code:`len(zeta)` ]. :code:`Nlat` will be determined from \</span>
<span class="sd">       the module by assessing the shape of Hloc. If :code:`ilat` is set, \</span>
<span class="sd">       the output will have one dimension less.</span>

<span class="sd">    :type axis: str </span>
<span class="sd">    :param axis: if :code:`zeta` is not provided, return the self-energy on the \</span>
<span class="sd">     Matsubara or Real axis with parameters set in the input file. \</span>
<span class="sd">     Can be :code:`m` for Matsubara(default) or :code:`r` for real.</span>
<span class="sd">        </span>
<span class="sd">    :type typ: str </span>
<span class="sd">    :param typ: whether to return the normal or anomalous self-energy \</span>
<span class="sd">     (for the superconducting case). Can be :code:`n` for normal (default)  \</span>
<span class="sd">     or :code:`a` for anomalous.</span>
<span class="sd">    </span>

<span class="sd">    :type zeta: complex **or** [complex] **or** np.array(dtype=complex)</span>
<span class="sd">    :param zeta: user-defined array of frequencies in the whole complex plane. \</span>
<span class="sd">     If none is provided, according to :code:`axis` the Matsubara or real axis is chosen</span>

<span class="sd">   </span>
<span class="sd">    :raise ValueError: If :code:`ishape` is incompatible woth :code:`ilat` or \</span>
<span class="sd">     not in the previous list.</span>
<span class="sd">    :raise ValueError: If :code:`axis` is not in the previous list.</span>
<span class="sd">     </span>
<span class="sd">    :return: An array of floats that contains the self-energy along the \</span>
<span class="sd">     specific axis, with dimension set by :code:`ishape` and :code:`zeta`, if present.  </span>
<span class="sd">    :rtype: np.array(dtype=float) </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ed_get_sigma_site_n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_sigma_site_n3</span>
    <span class="n">ed_get_sigma_site_n3</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_sigma_site_n3</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_sigma_site_n5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_sigma_site_n5</span>
    <span class="n">ed_get_sigma_site_n5</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_sigma_site_n5</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_sigma_lattice_n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_sigma_lattice_n3</span>
        <span class="n">ed_get_sigma_lattice_n3</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nineq</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># zeta</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
        <span class="p">]</span>
        <span class="n">ed_get_sigma_lattice_n3</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ed_get_sigma_lattice_n4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_sigma_lattice_n4</span>
        <span class="n">ed_get_sigma_lattice_n4</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nineq</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># zeta</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
        <span class="p">]</span>
        <span class="n">ed_get_sigma_lattice_n4</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ed_get_sigma_lattice_n6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_sigma_lattice_n6</span>
        <span class="n">ed_get_sigma_lattice_n6</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nineq</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># zeta</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
        <span class="p">]</span>
        <span class="n">ed_get_sigma_lattice_n6</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Global vars</span>
    <span class="n">norb_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">nspin_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Nspin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># zeta</span>
    <span class="k">if</span> <span class="n">zeta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">zeta</span><span class="p">):</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="p">[</span><span class="n">zeta</span><span class="p">]</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zeta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zflag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zeta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">nfreq</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Lmats&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfreq</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Lreal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">zflag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ishape</span>
    <span class="k">if</span> <span class="n">ishape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ishape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_hloc</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># axis</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
        <span class="n">axisint</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
        <span class="n">axisint</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;get_sigma: axis can only be &#39;m&#39; or &#39;r&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># typ</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
        <span class="n">typint</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
        <span class="n">typint</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;get_sigma: typ can only be &#39;n&#39; or &#39;a&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat is not defined in single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ed_get_sigma_site_n3</span><span class="p">(</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="n">nspin_aux</span><span class="p">,</span> <span class="n">nspin_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ed_get_sigma_site_n5</span><span class="p">(</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape(array) != 3,5 in get_sigma_site&quot;</span><span class="p">)</span>
        <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">Sigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Sigma</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">*</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">*</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nfreq</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ed_get_sigma_lattice_n3</span><span class="p">(</span>
                    <span class="n">Sigma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span>
                        <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nfreq</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ed_get_sigma_lattice_n4</span><span class="p">(</span>
                    <span class="n">Sigma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span>
                        <span class="n">nspin_aux</span><span class="p">,</span>
                        <span class="n">nspin_aux</span><span class="p">,</span>
                        <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nfreq</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ed_get_sigma_lattice_n6</span><span class="p">(</span>
                    <span class="n">Sigma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape(array) != 3,4,6 in get_sigma_lattice&quot;</span><span class="p">)</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">Sigma</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ishape</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">ilat</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sigma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span></div>



<span class="c1">#######################</span>
<span class="c1">#   GIMP              #</span>
<span class="c1">#######################</span>


<span class="c1"># backcompatibility, undocumented</span>
<span class="k">def</span> <span class="nf">build_gimp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gimp</span><span class="p">(</span><span class="n">zeta</span><span class="o">=</span><span class="n">zeta</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="n">ilat</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="n">ishape</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">typ</span><span class="p">)</span>


<span class="c1"># get gimp</span>
<div class="viewcode-block" id="get_gimp">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_gimp">[docs]</a>
<span class="k">def</span> <span class="nf">get_gimp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates the impurity Green&#39;s function for a user-chosen set \</span>
<span class="sd">     of frequencies in the complex plane</span>

<span class="sd">    :type ilat: int</span>
<span class="sd">    :param ilat: if the case of real-space DMFT, if only the self-energy of \</span>
<span class="sd">    a specific inequivalent site is needed, this can be specified.</span>
<span class="sd">        </span>
<span class="sd">    :type ishape: int </span>
<span class="sd">    :param ishape: this variable determines the shape of the returned array. \</span>
<span class="sd">     Possible values:</span>
<span class="sd">   </span>
<span class="sd">     * :code:`None`: the same shape as :code:`Hloc` plus one axis for frequency </span>
<span class="sd">     * :code:`3`: in the single-impurity case, it will return an array of the shape \</span>
<span class="sd">       [ :data:`Nspin` :math:`\\cdot`  :data:`Norb` ,  :data:`Nspin` :math:`\\cdot` \</span>
<span class="sd">       :data:`Norb` , :code:`len(zeta)` ]. In the real-space DMFT case, \</span>
<span class="sd">       it will return an array of the shape \</span>
<span class="sd">       [ :code:`Nlat` :math:`\\cdot`  :data:`Nspin` :math:`\\cdot`  :data:`Norb` , \</span>
<span class="sd">       :code:`Nlat` :math:`\\cdot` :data:`Nspin` :math:`\\cdot`  :data:`Norb` , \</span>
<span class="sd">       :code:`len(zeta)` ]. :code:`Nlat` will be determined from the module by \</span>
<span class="sd">       assessing the shape of Hloc. If :code:`ilat` is set, ValueError is returned.</span>
<span class="sd">     * :code:`4`: in the real-space DMFT case, it will return an array of the shape \</span>
<span class="sd">       [ :code:`Nlat` ,  :data:`Nspin` :math:`\\cdot`  :data:`Norb` ,  :data:`Nspin` \</span>
<span class="sd">       :math:`\\cdot`  :data:`Norb` , :code:`len(zeta)` `. :code:`Nlat` will \</span>
<span class="sd">       be determined from the module by assessing the shape of Hloc. If :code:`ilat`\</span>
<span class="sd">       is set, the output will have one dimension less.</span>
<span class="sd">     * :code:`5`: in the single-impurity case, it will return an array of the \</span>
<span class="sd">       shape [ :data:`Nspin` ,  :data:`Nspin` ,  :data:`Norb` ,  :data:`Norb` , \</span>
<span class="sd">       :code:`len(zeta)` ].</span>
<span class="sd">     * :code:`6`: in the real-space DMFT case, it will return an array of the \</span>
<span class="sd">       shape [ :code:`Nlat` ,  :data:`Nspin` ,  :data:`Nspin` ,  :data:`Norb` , \</span>
<span class="sd">       :data:`Norb` , :code:`len(zeta)` ]. \</span>
<span class="sd">       :code:`Nlat` will be determined from the module by assessing the shape of Hloc. \</span>
<span class="sd">       If :code:`ilat` is set, the output will have one dimension less.</span>

<span class="sd">    :type axis: str </span>
<span class="sd">    :param axis: if :code:`zeta` is not provided, return the self-energy on the \</span>
<span class="sd">     Matsubara or Real axis with parameters set in the input file. \</span>
<span class="sd">     Can be :code:`m` for Matsubara(default) or :code:`r` for real.</span>
<span class="sd">        </span>
<span class="sd">    :type typ: str </span>
<span class="sd">    :param typ: whether to return the normal or anomalous self-energy \</span>
<span class="sd">     (for the superconducting case). Can be :code:`n` for normal (default) or \</span>
<span class="sd">    :code:`a` for anomalous.</span>
<span class="sd">    </span>

<span class="sd">    :type zeta: complex **or** [complex] **or** np.array(dtype=complex)</span>
<span class="sd">    :param zeta: user-defined array of frequencies in the whole complex plane. \</span>
<span class="sd">     If none is provided, according to :code:`axis` the Matsubara or real axis is chosen</span>

<span class="sd">   </span>
<span class="sd">    :raise ValueError: If :code:`ishape` is incompatible woth :code:`ilat` or \</span>
<span class="sd">     not in the previous list.</span>
<span class="sd">    :raise ValueError: If :code:`axis` is not in the previous list.</span>
<span class="sd">     </span>
<span class="sd">    :return: An array of floats that contains the impurity Green&#39;s function along the \</span>
<span class="sd">     specific axis, with dimension set by :code:`ishape` and :code:`zeta`, if present.  </span>
<span class="sd">    :rtype: np.array(dtype=float) </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ed_get_gimp_site_n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_gimp_site_n3</span>
    <span class="n">ed_get_gimp_site_n3</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_gimp_site_n3</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_gimp_site_n5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_gimp_site_n5</span>
    <span class="n">ed_get_gimp_site_n5</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_gimp_site_n5</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
        <span class="n">ed_get_gimp_lattice_n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_gimp_lattice_n3</span>
        <span class="n">ed_get_gimp_lattice_n3</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nineq</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># zeta</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
        <span class="p">]</span>
        <span class="n">ed_get_gimp_lattice_n3</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ed_get_gimp_lattice_n4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_gimp_lattice_n4</span>
        <span class="n">ed_get_gimp_lattice_n4</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nineq</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># zeta</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
        <span class="p">]</span>
        <span class="n">ed_get_gimp_lattice_n4</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ed_get_gimp_lattice_n6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_gimp_lattice_n6</span>
        <span class="n">ed_get_gimp_lattice_n6</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># self</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nineq</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># typ</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
            <span class="p">),</span>  <span class="c1"># zeta</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dz</span>
            <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zflag</span>
        <span class="p">]</span>
        <span class="n">ed_get_gimp_lattice_n6</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Global vars</span>
    <span class="n">norb_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">nspin_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Nspin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># zeta</span>
    <span class="k">if</span> <span class="n">zeta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">zeta</span><span class="p">):</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="p">[</span><span class="n">zeta</span><span class="p">]</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zeta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zflag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zeta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span>
        <span class="p">):</span>  <span class="c1"># if the provided frequency array is not Matsubara, set axis=&quot;r&quot;</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">nfreq</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Lmats&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfreq</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Lreal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">zflag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ishape</span>
    <span class="k">if</span> <span class="n">ishape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ishape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_hloc</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># axis</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
        <span class="n">axisint</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
        <span class="n">axisint</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;get_gimp: axis can only be &#39;m&#39; or &#39;r&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># typ</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
        <span class="n">typint</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
        <span class="n">typint</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;get_gimp: typ can only be &#39;n&#39; or &#39;a&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ilat is not defined in single-impurity DMFT&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ed_get_gimp_site_n3</span><span class="p">(</span><span class="n">gimp</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">[</span><span class="n">nspin_aux</span><span class="p">,</span> <span class="n">nspin_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ed_get_gimp_site_n5</span><span class="p">(</span><span class="n">gimp</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape(array) != 3,5 in get_gimp_site&quot;</span><span class="p">)</span>
        <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">gimp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gimp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ineq</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">*</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">*</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nfreq</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ed_get_gimp_lattice_n3</span><span class="p">(</span>
                    <span class="n">gimp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span>
                        <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nfreq</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ed_get_gimp_lattice_n4</span><span class="p">(</span>
                    <span class="n">gimp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span>
                        <span class="n">nspin_aux</span><span class="p">,</span>
                        <span class="n">nspin_aux</span><span class="p">,</span>
                        <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">norb_aux</span><span class="p">,</span>
                        <span class="n">nfreq</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ed_get_gimp_lattice_n6</span><span class="p">(</span>
                    <span class="n">gimp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span><span class="p">,</span> <span class="n">axisint</span><span class="p">,</span> <span class="n">typint</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zflag</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape(array) != 3,4,6 in get_gimp_lattice&quot;</span><span class="p">)</span>
            <span class="n">gimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">gimp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ilat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ishape</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">gimp</span><span class="p">[</span><span class="n">ilat</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">gimp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span></div>



<span class="c1"># Anderson Impurity Model functions</span>


<span class="c1"># gimp</span>
<div class="viewcode-block" id="get_g0and">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_g0and">[docs]</a>
<span class="k">def</span> <span class="nf">get_g0and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">bath</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">       This function calculates the value of the Anderson Impurity Model&#39;s \</span>
<span class="sd">       noninteracting Green&#39;s function on a given frequency array.</span>

<span class="sd">       :type zeta: complex </span>
<span class="sd">       :param zeta: the array of frequencies (only frequencies on the real and \</span>
<span class="sd">        imaginary axes are supported)</span>
<span class="sd">       </span>
<span class="sd">       :type bath: float</span>
<span class="sd">       :param bath: the user-accessible bath array  </span>
<span class="sd">            </span>
<span class="sd">       :type ishape: int </span>
<span class="sd">       :param ishape: this variable determines the shape of the returned array.\</span>
<span class="sd">        Possible values:</span>
<span class="sd">       </span>
<span class="sd">        * :code:`None`: the same shape as :code:`Hloc` plus one axis for frequency </span>
<span class="sd">        * :code:`3`: the output array will have shape [ :data:`Nspin` \</span>
<span class="sd">          :math:`\\cdot` :data:`Norb` ,  :data:`Nspin` :math:`\\cdot`  \</span>
<span class="sd">          :data:`Norb` , :code:`len(zeta)` ]</span>
<span class="sd">        * :code:`5`: the output array will have shape [ :data:`Nspin` ,  \</span>
<span class="sd">          :data:`Nspin` ,  :data:`Norb` ,  :data:`Norb` ,  :code:`len(zeta)` ]</span>
<span class="sd">          </span>
<span class="sd">       :type typ: str </span>
<span class="sd">       :param typ: whether to return the normal or anomalous Green&#39;s function \</span>
<span class="sd">        (for the superconducting case). Can be :code:`n` for normal or :code:`a`\</span>
<span class="sd">        for anomalous.</span>
<span class="sd">       </span>
<span class="sd">       :raise ValueError: If :code:`zeta` is not completely real or completely \</span>
<span class="sd">        imaginary</span>
<span class="sd">       :raise ValueError: If :code:`ishape` is not 3 or 5.</span>
<span class="sd">               </span>
<span class="sd">       :return: An array of complex that contains :math:`G^{And}_{0}(z)` function \</span>
<span class="sd">         along the specific frequency array, with dimension set by \</span>
<span class="sd">        :code:`ishape` and :code:`zeta`.  </span>
<span class="sd">       :rtype: np.array(dtype=complex)</span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ed_get_g0and_n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_g0and_n3</span>
    <span class="n">ed_get_g0and_n3</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_char_p</span><span class="p">,</span>
        <span class="n">c_char_p</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ed_get_g0and_n3</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_g0and_n5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_g0and_n5</span>
    <span class="n">ed_get_g0and_n5</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_char_p</span><span class="p">,</span>
        <span class="n">c_char_p</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ed_get_g0and_n5</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">norb_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">nspin_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Nspin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="n">zeta</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span>
    <span class="n">bath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">bath</span><span class="p">)</span>

    <span class="n">nfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zeta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dimbath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">bath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zeta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">zeta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;get_g0and: frequencies can only be purely real or purely imaginary&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">ishape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ishape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_hloc</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">G0and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">DimG0and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ed_get_g0and_n3</span><span class="p">(</span>
            <span class="n">zeta</span><span class="p">,</span>
            <span class="n">nfreq</span><span class="p">,</span>
            <span class="n">bath</span><span class="p">,</span>
            <span class="n">dimbath</span><span class="p">,</span>
            <span class="n">G0and</span><span class="p">,</span>
            <span class="n">DimG0and</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">typ</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">G0and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span><span class="p">,</span> <span class="n">nspin_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">DimG0and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span><span class="p">,</span> <span class="n">nspin_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ed_get_g0and_n5</span><span class="p">(</span>
            <span class="n">zeta</span><span class="p">,</span>
            <span class="n">nfreq</span><span class="p">,</span>
            <span class="n">bath</span><span class="p">,</span>
            <span class="n">dimbath</span><span class="p">,</span>
            <span class="n">G0and</span><span class="p">,</span>
            <span class="n">DimG0and</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">typ</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape(array) != 3,5 in get_g0and&quot;</span><span class="p">)</span>
    <span class="n">G0and</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">G0and</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G0and</span></div>



<span class="c1"># Delta</span>
<div class="viewcode-block" id="get_delta">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_delta">[docs]</a>
<span class="k">def</span> <span class="nf">get_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">bath</span><span class="p">,</span> <span class="n">ishape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">       This function calculates the value of the Anderson Impurity Model&#39;s \</span>
<span class="sd">       hybridization function on a given frequency array.</span>

<span class="sd">       :type zeta: complex </span>
<span class="sd">       :param zeta: the array of frequencies (only frequencies on the real and \</span>
<span class="sd">        imaginary axes are supported)   </span>

<span class="sd">       :type bath: float</span>
<span class="sd">       :param bath: the user-accessible bath array  </span>
<span class="sd">            </span>
<span class="sd">       :type ishape: int </span>
<span class="sd">       :param ishape: this variable determines the shape of the returned array. \</span>
<span class="sd">        Possible values:</span>
<span class="sd">       </span>
<span class="sd">        * :code:`None`: the same shape as :code:`Hloc` plus one axis for frequency </span>
<span class="sd">        * :code:`3`: the output array will have shape [ :data:`Nspin` \</span>
<span class="sd">          :math:`\\cdot` :data:`Norb` ,  :data:`Nspin` :math:`\\cdot` \</span>
<span class="sd">          :data:`Norb` , :code:`len(zeta)` ]</span>
<span class="sd">        * :code:`5`: the output array will have shape [ :data:`Nspin` ,  \</span>
<span class="sd">          :data:`Nspin` ,  :data:`Norb` ,  :data:`Norb` ,  :code:`len(zeta)` ]</span>
<span class="sd">          </span>
<span class="sd">       :type typ: str </span>
<span class="sd">       :param typ: whether to return the normal or anomalous Green&#39;s function \</span>
<span class="sd">        (for the superconducting case). Can be :code:`n` for normal or :code:`a`\</span>
<span class="sd">        for anomalous.</span>
<span class="sd">       </span>
<span class="sd">       :raise ValueError: If :code:`zeta` is not completely real or completely \</span>
<span class="sd">        imaginary</span>
<span class="sd">       :raise ValueError: If :code:`ishape` is not 3 or 5.</span>
<span class="sd">               </span>
<span class="sd">       :return: An array of complex that contains :math:`\\Delta(z)` along the \</span>
<span class="sd">        specific frequency array, with dimension set by :code:`ishape` and \</span>
<span class="sd">        :code:`zeta`.  </span>
<span class="sd">       :rtype: np.array(dtype=complex) </span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ed_get_delta_n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_delta_n3</span>
    <span class="n">ed_get_delta_n3</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_char_p</span><span class="p">,</span>
        <span class="n">c_char_p</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ed_get_delta_n3</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_delta_n5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">get_delta_n5</span>
    <span class="n">ed_get_delta_n5</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_int</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">),</span>
        <span class="n">c_char_p</span><span class="p">,</span>
        <span class="n">c_char_p</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">ed_get_delta_n5</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">norb_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">nspin_aux</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Nspin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="n">zeta</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span>
    <span class="n">bath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">bath</span><span class="p">)</span>

    <span class="n">nfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zeta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dimbath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">bath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zeta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">zeta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;get_delta: frequencies can only be purely real or purely imaginary&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">ishape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ishape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_hloc</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">Delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">DimDelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nspin_aux</span> <span class="o">*</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ed_get_delta_n3</span><span class="p">(</span>
            <span class="n">zeta</span><span class="p">,</span>
            <span class="n">nfreq</span><span class="p">,</span>
            <span class="n">bath</span><span class="p">,</span>
            <span class="n">dimbath</span><span class="p">,</span>
            <span class="n">Delta</span><span class="p">,</span>
            <span class="n">DimDelta</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">typ</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ishape</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">Delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span><span class="p">,</span> <span class="n">nspin_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">DimDelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nspin_aux</span><span class="p">,</span> <span class="n">nspin_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">norb_aux</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ed_get_delta_n5</span><span class="p">(</span>
            <span class="n">zeta</span><span class="p">,</span>
            <span class="n">nfreq</span><span class="p">,</span>
            <span class="n">bath</span><span class="p">,</span>
            <span class="n">dimbath</span><span class="p">,</span>
            <span class="n">Delta</span><span class="p">,</span>
            <span class="n">DimDelta</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
            <span class="n">c_char_p</span><span class="p">(</span><span class="n">typ</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape(array) != 3,5 in get_delta&quot;</span><span class="p">)</span>
    <span class="n">Delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">Delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Delta</span></div>



<span class="c1">###################</span>
<span class="c1"># Susceptibilities #</span>
<span class="c1">###################</span>


<div class="viewcode-block" id="get_chi">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_chi">[docs]</a>
<span class="k">def</span> <span class="nf">get_chi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chan</span><span class="o">=</span><span class="s2">&quot;spin&quot;</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ilat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">       This function calculates the value of the Anderson Impurity Model&#39;s \</span>
<span class="sd">       response functions :math:`\\chi` in the spin, density, pairing and \</span>
<span class="sd">       exciton channels.</span>

<span class="sd">       :type chan: str </span>
<span class="sd">       :param chan: the channel of the response function. Possible values are \</span>
<span class="sd">        :code:`spin` ( :code:`s` ), :code:`dens` ( :code:`c` ), :code:`pair` \</span>
<span class="sd">        ( :code:`p` ), :code:`exct` ( :code:`e` ). Default is :code:`spin`.</span>
<span class="sd">       </span>
<span class="sd">       :type zeta: complex </span>
<span class="sd">       :param zeta: the array of frequencies or times (only frequencies on \</span>
<span class="sd">        the real imaginary axes and imaginary times are supported). If no array</span>
<span class="sd">        is provided, depending on the value of :data:`axis`, an array will be \</span>
<span class="sd">        generated on the positive Matsubara axis ( :data:`Lmats` values ), on \</span>
<span class="sd">        the real axis ( :data:`Lreal` values between :code:`0` and  \</span>
<span class="sd">        :data:`wfin`) or on the imaginary time axis (:data:`Ltau` values \</span>
<span class="sd">        between 0 and :data:`beta`)</span>

<span class="sd">       :type axis: str</span>
<span class="sd">       :param axis: the axis on which to calculate :math:`\\chi`. Possible values \</span>
<span class="sd">       :code:`matsubara` ( :code:`m`), :code:`real` ( :code:`r`), :code:`time` \</span>
<span class="sd">        ( :code:`t`). This parameter has to be specificed.</span>
<span class="sd">       </span>
<span class="sd">       :type ilat: int</span>
<span class="sd">       :param ilat: for real-space DMFT, if this flag is specified only the \</span>
<span class="sd">        susceptibility for the relative inequivalent atom is returned</span>
<span class="sd">        specified.</span>
<span class="sd">       </span>
<span class="sd">       </span>
<span class="sd">       :raise ValueError: If :f:var:`ed_mode` is not :code:`normal`</span>
<span class="sd">       :raise ValueError: If :code:`axis` not provided or invalid</span>
<span class="sd">       :raise ValueError: If :code:`chan` is invalid</span>
<span class="sd">               </span>
<span class="sd">       :return: An array of complex that contains :math:`\\chi` along the chosen \</span>
<span class="sd">        axis. The dimension of the array depends on the chosen channel:</span>

<span class="sd">        * [ :data:`Norb`, :data:`Norb` , :code:`len(zeta)` ] for \</span>
<span class="sd">          channel :code:`spin`, :code:`dens`, :code:`pair`</span>
<span class="sd">        * [ :code:`3`, :data:`Norb`, :data:`Norb` , :code:`len(zeta)` ] for channel \</span>
<span class="sd">          :code:`exct`, corresponding to singlet, triplet(xy) and triplet(z)</span>
<span class="sd">          </span>
<span class="sd">        One dimension corresponding to the number of inequivalent sites is added \</span>
<span class="sd">        at the beginning for the case of real-space DMFT and if ilat is None.</span>
<span class="sd">       :rtype: np.array(dtype=complex) </span>
<span class="sd">               </span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ed_get_spinchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_spinchi</span>
    <span class="n">ed_get_spinchi</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dim_zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zetaflag</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nsites</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># latticeflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_spinchi</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_denschi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_denschi</span>
    <span class="n">ed_get_denschi</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dim_zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zetaflag</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nsites</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># latticeflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_denschi</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_pairchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_pairchi</span>
    <span class="n">ed_get_pairchi</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dim_zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zetaflag</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nsites</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># latticeflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_pairchi</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ed_get_exctchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_exctchi</span>
    <span class="n">ed_get_exctchi</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># self</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span>
        <span class="p">),</span>  <span class="c1"># zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># dim_zeta</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># zetaflag</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># axis</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># nsites</span>
        <span class="n">c_int</span><span class="p">,</span>  <span class="c1"># latticeflag</span>
    <span class="p">]</span>
    <span class="n">ed_get_exctchi</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Nsites</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">latticeflag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_ineq</span><span class="p">:</span>
            <span class="n">Nsites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span>
            <span class="n">latticeflag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t use r-DMFT routines without installing EDIpack2ineq&quot;</span>
            <span class="p">)</span>

    <span class="n">aux_norb</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">aux_Lmats</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Lmats&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">aux_Lreal</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Lreal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">aux_Ltau</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Ltau&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">edmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ed_mode</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">edmode</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Susceptibility calculation not supported for ed_mode &quot;</span>
            <span class="s2">&quot;not = normal&quot;</span>
        <span class="p">)</span>

    <span class="n">zetaflag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Axis is required&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">zeta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">zetaflag</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">axisflag</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">nfreq</span> <span class="o">=</span> <span class="n">aux_Lmats</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
                <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">zetaflag</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">axisflag</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">nfreq</span> <span class="o">=</span> <span class="n">aux_Lreal</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
                <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">zetaflag</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">axisflag</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">nfreq</span> <span class="o">=</span> <span class="n">aux_Ltau</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="n">axisflag</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
                <span class="n">axisflag</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
                <span class="n">axisflag</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axis can only be m, r or t&quot;</span><span class="p">)</span>
            <span class="n">nfreq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">zeta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">or</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">Nsites</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
        <span class="p">)</span>
        <span class="n">ed_get_spinchi</span><span class="p">(</span>
            <span class="n">chi</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zetaflag</span><span class="p">,</span> <span class="n">axisflag</span><span class="p">,</span> <span class="n">Nsites</span><span class="p">,</span> <span class="n">latticeflag</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;dens&quot;</span> <span class="ow">or</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">Nsites</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
        <span class="p">)</span>
        <span class="n">ed_get_denschi</span><span class="p">(</span>
            <span class="n">chi</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zetaflag</span><span class="p">,</span> <span class="n">axisflag</span><span class="p">,</span> <span class="n">Nsites</span><span class="p">,</span> <span class="n">latticeflag</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;pair&quot;</span> <span class="ow">or</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">Nsites</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
        <span class="p">)</span>
        <span class="n">ed_get_pairchi</span><span class="p">(</span>
            <span class="n">chi</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zetaflag</span><span class="p">,</span> <span class="n">axisflag</span><span class="p">,</span> <span class="n">Nsites</span><span class="p">,</span> <span class="n">latticeflag</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;exct&quot;</span> <span class="ow">or</span> <span class="n">chan</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">[</span><span class="n">Nsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">aux_norb</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
        <span class="p">)</span>
        <span class="n">ed_get_exctchi</span><span class="p">(</span>
            <span class="n">chi</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">,</span> <span class="n">zetaflag</span><span class="p">,</span> <span class="n">axisflag</span><span class="p">,</span> <span class="n">Nsites</span><span class="p">,</span> <span class="n">latticeflag</span>
        <span class="p">)</span>

    <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nineq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">chi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ilat</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chi</span><span class="p">[</span><span class="n">ilat</span><span class="p">]</span></div>



<span class="c1">########################</span>
<span class="c1">#     RDM              #</span>
<span class="c1">########################</span>


<div class="viewcode-block" id="get_impurity_rdm">
<a class="viewcode-back" href="../../funcs/3_inputoutput.html#edipack2py.global_env.get_impurity_rdm">[docs]</a>
<span class="k">def</span> <span class="nf">get_impurity_rdm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doprint</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This function returns the impurity reduced density matrix (iRDM)</span>
<span class="sd">   </span>
<span class="sd">    :type doprint: bool</span>
<span class="sd">    :param doprint: if :code:`True`, the RDM is printed to file. </span>
<span class="sd">   </span>
<span class="sd">   </span>
<span class="sd">    :return: the impurity density matrix, a square matrix of \</span>
<span class="sd">     size :math:`4^{N_{orb}}\\times 4^{N_{orb}}`</span>
<span class="sd">    :rtype: np.array(dtype=complex) </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aux_norb</span> <span class="o">=</span> <span class="n">c_int</span><span class="o">.</span><span class="n">in_dll</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="p">,</span> <span class="s2">&quot;Norb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="n">ed_get_impurity_rdm_wrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">ed_get_impurity_rdm</span>
    <span class="n">ed_get_impurity_rdm_wrap</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;F_CONTIGUOUS&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">ed_get_impurity_rdm_wrap</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">rdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="o">**</span><span class="n">aux_norb</span><span class="p">,</span> <span class="mi">4</span><span class="o">**</span><span class="n">aux_norb</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">doprint</span><span class="p">:</span>
        <span class="n">ed_get_impurity_rdm_wrap</span><span class="p">(</span><span class="n">rdm</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ed_get_impurity_rdm_wrap</span><span class="p">(</span><span class="n">rdm</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">rdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">rdm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rdm</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Lorenzo Crippa and Adriano Amaricci.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>